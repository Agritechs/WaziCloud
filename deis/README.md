
DEIS on SIRIS
=============

Instructions here: http://docs.deis.io/en/latest/installing_deis/openstack/

First [get DEIS sources](http://docs.deis.io/en/latest/installing_deis/quick-start/#get-the-source).


SIRIS config
------------

Set up the VPN:
https://docs.google.com/document/d/1RIbKSA00GF6niHHV6OpBXCxH1PJVn2nZxf8oIe7c3QI/edit

VPN is necessary to access the API of SIRIS openstack.

VM provisioning
---------------

Install nova, neutron, glance on your system:

```
apt-get install python-glanceclient
apt-get install python-neutronclient
apt-get install python-novaclient
```

Edit openrc.hs with your credentials:
```
source openrc.sh
```

Add your key pair to nova:
```
nova keypair-add --pub-key ~/.ssh/deis.pub deis-key
```

Generate a discovery URL (from DEIS repository):
```
make discovery-url
```

Set environment variables:
```
export DEIS_NUM_INSTANCES=3
#export DEIS_CIDR=10.21.12.0/24
export DEIS_DNS=8.8.8.8
#export DEIS_NETWORK=local
```

Start provision script:
```
cd deis/contrib/openstack
./provision-openstack-cluster.sh CoreOS deis-key
```
This script:
- create a security group "deis"
- create a subnet "deis"
- create 3 VMs, passing the user_data file generated by `make discovery-url`.

After the subnet has been created, you need to add an interface to the router "default" in SIRIS.
This interface shoudl point to "deis" subnet otherwise the VMs will have no access to internet.
Delete the 3 VMs and restart the script so the networking is correct upon creation of the VMs.

Associate floating IP:
```
nova floating-ip-associate deis-1 217.77.95.64
```

Test access to first VM:
```
ssh core@217.77.95.64
nmap 217.77.95.64
```


DEIS install
------------

Install [deisctl](http://docs.deis.io/en/latest/installing_deis/install-deisctl/#install-deisct)

Add deis key to SSH agent:
```
ssh-add ~/.ssh/deis
```

Add DEIS tunnel:
```
export DEISCTL_TUNNEL=217.77.95.64
```

Add remote keys:
```
deisctl config platform set sshPrivateKey=~/.ssh/deis
```

Add domain name for apps:
```
deisctl config platform set domain=waziup.io
```

Install DEIS:
```
deisctl install platform
```

Start DEIS:
```
deisctl start platform
```

Using DEIS
----------
